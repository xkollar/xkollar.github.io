<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>xkollar - Humbling Experience</title>
<link rel="feed" type="application/atom+xml" href="../atom.xml" title="Atom Feed">
<link rel="shortcut icon" type="image/x-icon" href="../images/favicon.ico" sizes="16x16 32x32 48x48 64x64 128x128 256x256">
<link rel="stylesheet" type="text/css" href="../css/main.css">
</head>
<body><div class="wrapper"><header><span id="not-title">tenticle</span><nav><ul><li><a href="../" rel="home">Main</a></li><span class="space"> </span><li><a href="../archive.html" rel="directory">Archive</a> <ul class="tags"><li><a href="../tags/Fun.html">Fun</a></li><span class="space"> </span><li><a href="../tags/Haskell.html">Haskell</a></li><span class="space"> </span><li><a href="../tags/Music.html">Music</a></li><span class="space"> </span><li><a href="../tags/">...</a></li></ul></li></ul></nav></header><div class="main"><h1>Humbling Experience</h1><div class="info">Posted on 2024-01-31 by xkollar  <span class="tags">in <a title="All pages tagged 'Bash'." href="../tags/Bash.html">Bash</a>, <a title="All pages tagged 'Fun'." href="../tags/Fun.html">Fun</a></span>.</div><p>I’m relatively comfortable with Bash but when the other day I saw <a href="https://stackoverflow.com/questions/6250698/how-to-decode-url-encoded-string-in-shell/37840948#37840948">this Stack
Overflow answer on how to decode URL-encoded string in
shell</a>
my brain took a moment to process it.</p>
<figure>
<img src="https://i.imgflip.com/h4gba.jpg" onerror="this.src='data:image/png;base64,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'" alt="What?" /><figcaption aria-hidden="true">What?</figcaption>
</figure>
<p>Let me copy it here just to appreciate it.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> urldecode()</span> <span class="kw">{</span> <span class="bu">:</span> <span class="st">&quot;</span><span class="va">${*</span><span class="op">//</span><span class="ss">+</span><span class="op">/</span> <span class="va">}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${_</span><span class="op">//</span><span class="ss">%</span><span class="op">/</span><span class="dt">\\</span>x<span class="va">}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span></code></pre></div>
<p>Let’s explore what is going on here, looking at it in an easier-to-digest(?) form:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> urldecode()</span> <span class="kw">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">:</span> <span class="st">&quot;</span><span class="va">${*</span><span class="op">//</span><span class="ss">+</span><span class="op">/</span> <span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${_</span><span class="op">//</span><span class="ss">%</span><span class="op">/</span><span class="dt">\\</span>x<span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>First part is using builtin <code class="sourceCode bash"><span class="bu">:</span></code> with the (single) argument being
expansion of all the function’s arguments into a single string
<code class="sourceCode bash"><span class="st">&quot;</span><span class="va">${*}</span><span class="st">&quot;</span></code> while replacing all the occurrences of <code>+</code> with space
(double-forward-slash pattern substitution).</p>
<p>Confusing part is that <code class="sourceCode bash"><span class="bu">:</span></code> builtin kinda does nothing (except for
exiting with 0; many of you have probably invoked a spell of shape
<code>while :; do something; done</code> or used it as a part of comment/documentation
when combined with here document). While this looks like a
<a href="https://en.wikipedia.org/wiki/NOP_(code)"><code>nop</code></a>/pass/… it is not.</p>
<p>The magic is revealed when we inspect the following line where special
variable <code class="sourceCode bash"><span class="va">${_}</span></code> is used. From
<a href="https://www.gnu.org/software/bash/manual/bash.html#index-_005f">Bash documentation</a>,
in this case it</p>
<blockquote>
<p>expands to the last argument to the previous simple command executed in the
foreground, after expansion.</p>
</blockquote>
<p>Therefore the purpose of the previous line was “just” to set <code>${_}</code>. There all
the percent signs get replaced with <code>\x</code> (double backslash
for escaping in <code>"</code>) and pass that to <code>echo -e</code> for evaluation.</p>
<p>Obviously, people who <a href="2020-11-23-bash-interview-echo.html">read me</a> know
there is a bug: <code>urldecode -e</code> will return nothing. It is still very elegant way to
solve task at hand on command line. Easy fix with <code>printf '%b'</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> urldecode()</span> <span class="kw">{</span> <span class="bu">:</span> <span class="st">&quot;</span><span class="va">${*</span><span class="op">//</span><span class="ss">+</span><span class="op">/</span> <span class="va">}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="bu">printf</span> %b <span class="st">&quot;</span><span class="va">${_</span><span class="op">//</span><span class="ss">%</span><span class="op">/</span><span class="dt">\\</span>x<span class="va">}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span></code></pre></div>
</div><footer><p>Find me on <a href="https://github.com/xkollar/">GitHub</a>. Fancy an <a href="../atom.xml">Atom feed</a>?</p><p>H4sIAIisZlgAA3PLzy9JLdLT0wMAzFDh2gkAAAA=</p><p>Version 1, powered by <a href="https://jaspervdj.be/hakyll">Hakyll</a>.</p></footer></div></body>
</html>
