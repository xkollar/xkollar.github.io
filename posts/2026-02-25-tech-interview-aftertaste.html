<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>xkollar - Tech Interview: Aftertaste</title>
<link rel="feed" type="application/atom+xml" href="../atom.xml" title="Atom Feed">
<link rel="shortcut icon" type="image/x-icon" href="../images/favicon.ico" sizes="16x16 32x32 48x48 64x64 128x128 256x256">
<link rel="stylesheet" type="text/css" href="../css/main.css">
</head>
<body><div class="wrapper"><header><span id="not-title">tenticle</span><nav><ul><li><a href="../" rel="home">Main</a></li><span class="space"> </span><li><a href="../archive.html" rel="directory">Archive</a> <ul class="tags"><li><a href="../tags/Fun.html">Fun</a></li><span class="space"> </span><li><a href="../tags/Haskell.html">Haskell</a></li><span class="space"> </span><li><a href="../tags/Music.html">Music</a></li><span class="space"> </span><li><a href="../tags/">...</a></li></ul></li></ul></nav></header><div class="main"><h1>Tech Interview: Aftertaste</h1><div class="info">Posted on 2026-02-25 by xkollar  <span class="tags">in <a title="All pages tagged 'Fun'." href="../tags/Fun.html">Fun</a>, <a title="All pages tagged 'Interview'." href="../tags/Interview.html">Interview</a>, <a title="All pages tagged 'Haskell'." href="../tags/Haskell.html">Haskell</a></span>.</div><!--
Self note: story about starting simple and finding similarity? Exploring
problem space?
-->
<!-- Dedication: For those "Actually, Fib can be done in constant time" readers -->
<p>Interviews take a lot of energy. In general but
<a href="2026-01-25-tech-interview-ii.html" rel="prev">this one in particular</a>.
And getting through it also deserves a little celebration. Whatever
the reason, it is sort of a ritual to go to a nearby food place after.
Raw protein wrapped in carbs, if it can be helped.</p>
<p>The place is quiet, well past the rush of a lunch time, well before the noise
of an evening. Getting ready your linear utensils and squishing totally
reasonable blobs of green stuff onto your units of sustenance, a thought
keeps coming back to you:</p>
<div class="speaker b">
<p>Can we do any better?</p>
</div>
<p>You pull out a writing device of your choice and a generic white-label
wire-bound notebook. You open the notebook on a fresh page and stare at
the empty lines for a bit.</p>
<p>There was a class where someone derived a formula for the Fibonacci
numbers. Or someone mentioned it. And it was exciting. What was it
all about? Something around representing sequences of numbers as
polynomials. Was it called <a href="https://en.wikipedia.org/wiki/Generating_function">generating functions</a>?</p>
<p>Starting simple is usually a good idea. Maybe encoding a list of all ones?
In polynomials, the various powers of the variable naturally separate their
coefficients. So a sequence <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mi>‚ãØ</mi></mrow><annotation encoding="application/x-tex">1, 1, 1, 1, 1, 1, \cdots</annotation></semantics></math> could be represented
as a polynomial on <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> with</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>+</mo><mi>x</mi><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><mi>‚ãØ</mi></mrow><annotation encoding="application/x-tex">
f(x) = 1 + x + x^2 + x^3 + x^4 + \cdots
</annotation></semantics></math></p>
<p>That does not look very useful, but you won‚Äôt let that discourage you.
This will need some poking around. A fun thing that can be done
with polynomials is to multiply it by the variable, so you try that.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>‚ãÖ</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>+</mo><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.222em"></mspace><mi>x</mi><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><mi>‚ãØ</mi></mrow><annotation encoding="application/x-tex">
x \cdot f(x) = (0 +\!)\ x + x^2 + x^3 + x^4 + \cdots
</annotation></semantics></math></p>
<p>Fascinating: This way we shifted the sequence and prepended 0!
This now represents <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mi>‚ãØ</mi></mrow><annotation encoding="application/x-tex">0, 1, 1, 1, 1, 1, \cdots</annotation></semantics></math>. Things are emerging
from murky depths of memory. Let‚Äôs subtract those‚Ä¶</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>x</mi><mo>‚ãÖ</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">
f(x) - x \cdot f(x) = 1
</annotation></semantics></math></p>
<p>Now this looks very promising. Suddenly the whole expression becomes
very finite. No need to dance around the infinity with ellipsis‚Ä¶
Just few small steps later we get</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>‚àí</mo><mi>x</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
f(x) = \frac{1}{1-x}
</annotation></semantics></math></p>
<p>Somehow, this fraction captures the infinite list of ones.
While possibly not very useful on its own, this feels like an important
piece of a puzzle.</p>
<p>And the whole process reminded you of writing the infinite list
of Fibonacci numbers in Haskell.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">fibs ::</span> [<span class="dt">Integer</span>]</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fibs <span class="ot">=</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">1</span> <span class="op">:</span> <span class="fu">zipWith</span> (<span class="op">+</span>) fibs (<span class="fu">tail</span> fibs)</span></code></pre></div>
<p>And so you try representing the sequence:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left"><mn>0</mn><mo>+</mo><mn>1</mn><mi>x</mi><mo>+</mo><mn>1</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>3</mn><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><mn>5</mn><msup><mi>x</mi><mn>5</mn></msup><mo>+</mo><mi>‚ãØ</mi></mtd></mtr><mtr><mtd columnalign="right"><mi>x</mi><mo>‚ãÖ</mo><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left"><mn>0</mn><mo>+</mo><mn>0</mn><mi>x</mi><mo>+</mo><mn>1</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><mn>3</mn><msup><mi>x</mi><mn>5</mn></msup><mo>+</mo><mi>‚ãØ</mi></mtd></mtr><mtr><mtd columnalign="right"><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>x</mi><mo>‚ãÖ</mo><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left"><mn>0</mn><mo>+</mo><mn>1</mn><mi>x</mi><mo>+</mo><mn>0</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>1</mn><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>5</mn></msup><mo>+</mo><mi>‚ãØ</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
\overline{\mathrm{fib}}(x) =&amp; 0 + 1x + 1x^2 + 2x^3 + 3x^4 + 5x^5 + \cdots \\
x \cdot \overline{\mathrm{fib}}(x) =&amp; 0 + 0x + 1x^2 + 1x^3 + 2x^4 + 3x^5 + \cdots \\
\overline{\mathrm{fib}}(x) - x \cdot \overline{\mathrm{fib}}(x)
                                   =&amp; 0 + 1x + 0x^2 + 1x^3 + 1x^4 + 2x^5 + \cdots \\
\end{align}
</annotation></semantics></math></p>
<p>It takes a bit of squinting to realize that the right side is a Fibonacci sequence shifted by 2 positions with extra x
(elements of which you can kinda see in the Haskell implementation!):</p>
<div style="color: orange">
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>x</mi><mo>‚ãÖ</mo><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left"><mi>x</mi><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>‚ãÖ</mo><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right"><mi>‚ãØ</mi><mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo></mtd><mtd columnalign="left"><mfrac><mi>x</mi><mrow><mn>1</mn><mo>‚àí</mo><mi>x</mi><mo>‚àí</mo><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
\overline{\mathrm{fib}}(x) - x \cdot \overline{\mathrm{fib}}(x)
 =&amp; x + x^2 \cdot \overline{\mathrm{fib}}(x) \\
\cdots{} \\
\overline{\mathrm{fib}}(x) =&amp; \frac{x}{1 - x - x^2}
\end{align}
</annotation></semantics></math></p>
</div>
<div class="speaker b">
<p>This is great, except, what do I do with this? How do I get
back to elements of the sequence? Or even better, how do I
get to an element at a given position?</p>
</div>
<div class="speaker a">
<p>Try deriving expression for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>‚àë</mo><mrow><mi>i</mi><mo>‚àà</mo><msub><mstyle mathvariant="double-struck"><mi>‚Ñï</mi></mstyle><mn>0</mn></msub></mrow></msub><mi>Œ±</mi><msup><mrow></mrow><mi>i</mi></msup><msup><mi>x</mi><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">\sum_{i\in\mathbb{N}_0} \alpha{}^i x^i</annotation></semantics></math>.</p>
</div>
<div class="speaker b">
<p>Is that going to help‚Ä¶‚ÄΩ</p>
</div>
<p>You got almost to the end of that sentence before you realized, all at once,
that the interviewer from earlier:</p>
<ul>
<li>is sitting right next to you;</li>
<li>must have been peeking over your shoulder;</li>
<li>is looking at you with mild interest;</li>
<li>has mouth freshly stuffed with what looks
<a href="https://theoldvillage.wordpress.com/2004/01/28/douglas-adams-shares-a-true-story/">suspiciously similar to your own food</a>.</li>
</ul>
<div class="speaker b">
<p>How long have you‚Ä¶</p>
</div>
<div class="speaker a">
<p>Just try.</p>
</div>
<p>Trying to not get too distracted by what just happened
you repeat the steps, but with extra <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mrow></mrow></mrow><annotation encoding="application/x-tex">\alpha{}</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><mrow><mn>1</mn><mo>‚àí</mo><mi>Œ±</mi><mrow></mrow><mi>x</mi></mrow></mfrac></mstyle><mo>=</mo><mn>1</mn><mo>+</mo><mi>Œ±</mi><mrow></mrow><mi>x</mi><mo>+</mo><msup><mi>Œ±</mi><mn>2</mn></msup><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>Œ±</mi><msup><mrow></mrow><mn>3</mn></msup><msup><mi>x</mi><mn>3</mn></msup><mi>‚ãØ</mi></mrow><annotation encoding="application/x-tex">
\dfrac{1}{1-\alpha{}x} = 1 + \alpha{}x + \alpha^2x^2 + \alpha{}^3x^3 \cdots
</annotation></semantics></math></p>
<p>That is actually very useful! If we find an appropriately shaped expression,
this formula allows us to find n-th element in the sequence on its own! And
polynomials are easy to sum as we saw earlier. That is handy. So is the
pattern for adding two fractions. Now if only we could express this generating
function as a sum of appropriate forms‚Ä¶</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>A</mi><mrow><mn>1</mn><mo>‚àí</mo><mi>Œ±</mi><mrow></mrow><mi>x</mi></mrow></mfrac><mo>+</mo><mfrac><mi>B</mi><mrow><mn>1</mn><mo>‚àí</mo><mi>Œ≤</mi><mrow></mrow><mi>x</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\frac{A}{1-\alpha{}x} + \frac{B}{1-\beta{}x}
</annotation></semantics></math></p>
<details>
<summary>
Using quadratic formula you find the roots of the denominator.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mn>1</mn><mo>,</mo><mn>2</mn></mrow></msub><mo>=</mo><mo>‚àí</mo><mfrac><mrow><mn>1</mn><mo>¬±</mo><msqrt><mn>5</mn></msqrt></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">
x_{1,2} = - \frac{1 \pm \sqrt{5}}{2}
</annotation></semantics></math>
</summary>
<p>Ugh‚Ä¶ Do I even remember quadratic formula? Let me try to remember real quick.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><mi>a</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi></mtd><mtd columnalign="left"><mo>=</mo><mn>0</mn></mtd><mtd columnalign="right"><mi>/</mi><mi>a</mi></mtd></mtr><mtr><mtd columnalign="right"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mfrac><mi>b</mi><mi>a</mi></mfrac><mi>x</mi><mo>+</mo><mfrac><mi>c</mi><mi>a</mi></mfrac></mtd><mtd columnalign="left"><mo>=</mo><mn>0</mn></mtd><mtd columnalign="right"><mo>‚àí</mo><mfrac><mi>c</mi><mi>a</mi></mfrac></mtd></mtr><mtr><mtd columnalign="right"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mfrac><mi>b</mi><mi>a</mi></mfrac><mi>x</mi></mtd><mtd columnalign="left"><mo>=</mo><mo>‚àí</mo><mfrac><mi>c</mi><mi>a</mi></mfrac></mtd><mtd columnalign="right"><mo>+</mo><msup><mfrac><mi>b</mi><mrow><mn>2</mn><mi>a</mi></mrow></mfrac><mn>2</mn></msup></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
ax^2 + bx + c                    &amp;= 0             &amp; /a \\
x^2 + \frac{b}{a}x + \frac{c}{a} &amp;= 0             &amp; - \frac{c}{a} \\
x^2 + \frac{b}{a}x               &amp;= - \frac{c}{a} &amp; + \frac{b}{2a}^2 \\
\end{align}
</annotation></semantics></math></p>
<p>This way we get the left side to shape of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><mi>a</mi><mi>b</mi><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">a^2 + 2ab + b^2</annotation></semantics></math>.</p>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mfrac><mi>b</mi><mi>a</mi></mfrac><mi>x</mi><mo>+</mo><msup><mfrac><mi>b</mi><mrow><mn>2</mn><mi>a</mi></mrow></mfrac><mn>2</mn></msup></mtd><mtd columnalign="left"><mo>=</mo><mo>‚àí</mo><mfrac><mi>c</mi><mi>a</mi></mfrac><mo>+</mo><msup><mfrac><mi>b</mi><mrow><mn>2</mn><mi>a</mi></mrow></mfrac><mn>2</mn></msup></mtd><mtd columnalign="right"><mrow><mtext mathvariant="normal">undo </mtext><mspace width="0.333em"></mspace></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mtd></mtr><mtr><mtd columnalign="right"><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>+</mo><mfrac><mi>b</mi><mrow><mn>2</mn><mi>a</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mtd><mtd columnalign="left"><mo>=</mo><mo>‚àí</mo><mfrac><mi>c</mi><mi>a</mi></mfrac><mo>+</mo><msup><mfrac><mi>b</mi><mrow><mn>2</mn><mi>a</mi></mrow></mfrac><mn>2</mn></msup></mtd><mtd columnalign="right"><msqrt><mrow><mspace width="1.0em"></mspace><mrow></mrow></mrow></msqrt></mtd></mtr><mtr><mtd columnalign="right"><mo>¬±</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>+</mo><mfrac><mi>b</mi><mrow><mn>2</mn><mi>a</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left"><mo>=</mo><mfrac><msqrt><mrow><msup><mi>b</mi><mn>2</mn></msup><mo>‚àí</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></msqrt><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right"><mi>x</mi></mtd><mtd columnalign="left"><mo>=</mo><mfrac><mrow><mo>‚àí</mo><mi>b</mi><mo>¬±</mo><msqrt><mrow><msup><mi>b</mi><mn>2</mn></msup><mo>‚àí</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align}
x^2 + \frac{b}{a}x + \frac{b}{2a}^2 &amp;= - \frac{c}{a} + \frac{b}{2a}^2 &amp; \text{undo $(a+b)^2$} \\
(x+\frac{b}{2a})^2 &amp;= - \frac{c}{a} + \frac{b}{2a}^2 &amp; \sqrt{\quad{}} \\
\pm(x+\frac{b}{2a}) &amp;= \frac{\sqrt{b^2 - 4ac}}{2a} \\
x &amp;= \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} \\
\end{align}
</annotation></semantics></math>
</details>
<details>
<summary>
From there you reconstruct the individual factors.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>‚àí</mo><mi>x</mi><mo>‚àí</mo><msup><mi>x</mi><mn>2</mn></msup><mo>=</mo><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>+</mo><mfrac><mrow><mn>1</mn><mo>+</mo><msqrt><mn>5</mn></msqrt></mrow><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>+</mo><mfrac><mrow><mn>1</mn><mo>‚àí</mo><msqrt><mn>5</mn></msqrt></mrow><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
1 - x - x^2 = -(x+\frac{1+\sqrt{5}}{2})(x+\frac{1-\sqrt{5}}{2})
</annotation></semantics></math>
</summary>
Roots are only points where the parabola crosses the x-axis, we need to fit
it with multiplicative component, and that is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-1</annotation></semantics></math>.
</details>
<p>Next goal is to find <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math> such that</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>A</mi><mrow><mi>x</mi><mo>+</mo><mfrac><mrow><mn>1</mn><mo>+</mo><msqrt><mn>5</mn></msqrt></mrow><mn>2</mn></mfrac></mrow></mfrac><mo>‚àí</mo><mfrac><mi>B</mi><mrow><mi>x</mi><mo>+</mo><mfrac><mrow><mn>1</mn><mo>‚àí</mo><msqrt><mn>5</mn></msqrt></mrow><mn>2</mn></mfrac></mrow></mfrac><mo>=</mo><mover><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mo accent="true">¬Ø</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\frac{A}{x+\frac{1+\sqrt{5}}{2}} - \frac{B}{x+\frac{1-\sqrt{5}}{2}} = \overline{\mathrm{fib}}(x)
</annotation></semantics></math></p>
<p>(arbitrarily putting minus on the side of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>). It takes a bit of a paper
real-estate, but eventually you get to</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>,</mo><mi>B</mi><mo>=</mo><mo>‚àí</mo><mfrac><mrow><mn>1</mn><mo>¬±</mo><mrow></mrow><msqrt><mn>5</mn></msqrt></mrow><mrow><mn>2</mn><msqrt><mn>5</mn></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">
A,B = -\frac{1\pm{}\sqrt{5}}{2\sqrt{5}}
</annotation></semantics></math></p>
<p>Even more paper is burned on re-shaping the denominator to the desired
form of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>‚àí</mo><mi>Œ±</mi><mrow></mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">1 - \alpha{}x</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mo>‚àí</mo><mfrac><mn>1</mn><msqrt><mn>5</mn></msqrt></mfrac></mrow><mrow><mn>1</mn><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo>‚àí</mo><mn>2</mn></mrow><mrow><mn>1</mn><mo>+</mo><msqrt><mn>5</mn></msqrt></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>x</mi></mrow></mfrac><mo>+</mo><mfrac><mfrac><mn>1</mn><msqrt><mn>5</mn></msqrt></mfrac><mrow><mn>1</mn><mo>‚àí</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo>‚àí</mo><mn>2</mn></mrow><mrow><mn>1</mn><mo>‚àí</mo><msqrt><mn>5</mn></msqrt></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>x</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\frac{-\frac{1}{\sqrt{5}}}{1 -(\frac{-2}{1+\sqrt{5}})x} + \frac{\frac{1}{\sqrt{5}}}{1 -(\frac{-2}{1-\sqrt{5}})x}
</annotation></semantics></math></p>
<p>And from there n-th element (coefficient for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>x</mi><mi>n</mi></msup><annotation encoding="application/x-tex">x^n</annotation></semantics></math>) is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚àí</mo><mfrac><mn>1</mn><msqrt><mn>5</mn></msqrt></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo>‚àí</mo><mn>2</mn></mrow><mrow><mn>1</mn><mo>+</mo><msqrt><mn>5</mn></msqrt></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>n</mi></msup><mo>+</mo><mfrac><mn>1</mn><msqrt><mn>5</mn></msqrt></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo>‚àí</mo><mn>2</mn></mrow><mrow><mn>1</mn><mo>‚àí</mo><msqrt><mn>5</mn></msqrt></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>n</mi></msup><mo>=</mo><mfrac><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo>‚àí</mo><mn>2</mn></mrow><mrow><mn>1</mn><mo>‚àí</mo><msqrt><mn>5</mn></msqrt></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>n</mi></msup><mo>‚àí</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mo>‚àí</mo><mn>2</mn></mrow><mrow><mn>1</mn><mo>+</mo><msqrt><mn>5</mn></msqrt></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>n</mi></msup></mrow><msqrt><mn>5</mn></msqrt></mfrac></mrow><annotation encoding="application/x-tex">
-\frac{1}{\sqrt{5}}(\frac{-2}{1+\sqrt{5}})^n + \frac{1}{\sqrt{5}}(\frac{-2}{1-\sqrt{5}})^n = \frac{(\frac{-2}{1-\sqrt{5}})^n-(\frac{-2}{1+\sqrt{5}})^n}{\sqrt{5}}
</annotation></semantics></math></p>
<div class="speaker a">
<p>Great work! You can rationalize the denominators in those bases to
make it prettier (and maybe a bit more useful) üëç.</p>
</div>
<p>That sounds reasonable.</p>
<div style="color: orange">
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathvariant="normal"><mi>f</mi><mi>i</mi><mi>b</mi></mstyle><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mn>1</mn><mo>+</mo><msqrt><mn>5</mn></msqrt></mrow><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>n</mi></msup><mo>‚àí</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mn>1</mn><mo>‚àí</mo><msqrt><mn>5</mn></msqrt></mrow><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>n</mi></msup></mrow><msqrt><mn>5</mn></msqrt></mfrac></mrow><annotation encoding="application/x-tex">
\mathrm{fib}(n) = \frac{(\frac{1+\sqrt{5}}{2})^n-(\frac{1-\sqrt{5}}{2})^n}{\sqrt{5}}
</annotation></semantics></math></p>
</div>
<div class="speaker b">
<p>Well, that‚Äôs a beautiful closed form. And strange one too: all the irrational
numbers, yet it produces natural numbers.</p>
<p>However it still does not allow us to calculate n-th Fibonacci number
in sub-log time! If it was possible there would be some great
improvements to be made here:</p>
<ul>
<li><a href="https://github.com/python/cpython/blob/66bca383bd3b12d21e879d991d77b37a4c638f88/Objects/floatobject.c#L685-L802">cpython‚Äôs Objects/floatobject.c</a></li>
<li><a href="https://github.com/python/cpython/blob/66bca383bd3b12d21e879d991d77b37a4c638f88/Objects/longobject.c#L4983-L5261">cpython‚Äôs Objects/longobject.c</a></li>
</ul>
</div>
<!-- So actually actually: It can't -->
<div class="speaker a">
<p>Excellent insight. Now how would you turn this into
a function that is able to calculate exact results
on unbounded numbers?</p>
</div>
<div class="speaker b">
<figure>
<a href="https://tenor.com/btXLD.gif"><img src="https://media1.tenor.com/m/jZVZa853eNEAAAAd/gif.gif" alt="Challenge accepted" /></a>
</figure>
<p>The trick is that we don‚Äôt need exact value of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mn>5</mn></msqrt><annotation encoding="application/x-tex">\sqrt{5}</annotation></semantics></math>. We can
treat it as a special symbol for which <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mn>5</mn></msqrt><mo>‚ãÖ</mo><msqrt><mn>5</mn></msqrt><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">\sqrt{5} \cdot \sqrt{5} = 5</annotation></semantics></math>.
Similar-ish to introducing <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>‚ãÖ</mo><mi>i</mi><mo>=</mo><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i \cdot i = -1</annotation></semantics></math>.</p>
<p>Or we can see it as polynomials factored with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">x^2 = 5</annotation></semantics></math>.</p>
</div>
<div class="speaker a">
<p>All of it sounds reasonable. But let‚Äôs let the code speak.</p>
</div>
<div class="speaker b">
<p>Okay, here goes nothing, but I am a bit tired so I‚Äôll do
some heavy hand-waving‚Ä¶</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Ratio</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">S5</span> a <span class="ot">=</span> <span class="dt">S</span> <span class="op">!</span>a <span class="op">!</span>a <span class="kw">deriving</span> <span class="dt">Show</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ot">s5 ::</span> <span class="dt">Num</span> a <span class="ot">=&gt;</span> <span class="dt">S5</span> a</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>s5 <span class="ot">=</span> <span class="dt">S</span> <span class="dv">0</span> <span class="dv">1</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Num</span> a <span class="ot">=&gt;</span> <span class="dt">Num</span> (<span class="dt">S5</span> a) <span class="kw">where</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">S</span> a b <span class="op">+</span> <span class="dt">S</span> c d <span class="ot">=</span> <span class="dt">S</span> (a<span class="op">+</span>c) (b<span class="op">+</span>d)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">S</span> a b <span class="op">-</span> <span class="dt">S</span> c d <span class="ot">=</span> <span class="dt">S</span> (a<span class="op">-</span>c) (b<span class="op">-</span>d)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">S</span> a b <span class="op">*</span> <span class="dt">S</span> c d <span class="ot">=</span> <span class="dt">S</span> (a<span class="op">*</span>c<span class="op">+</span><span class="dv">5</span><span class="op">*</span>b<span class="op">*</span>d) (a<span class="op">*</span>d<span class="op">+</span>b<span class="op">*</span>c)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fromInteger</span> a <span class="ot">=</span> <span class="dt">S</span> (<span class="fu">fromInteger</span> a) <span class="dv">0</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">negate</span> (<span class="dt">S</span> a b) <span class="ot">=</span> <span class="dt">S</span> (<span class="fu">negate</span> a) (<span class="fu">negate</span> b)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abs</span> _ <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;leave me alone&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">signum</span> _ <span class="ot">=</span> <span class="fu">error</span> <span class="st">&quot;meh&quot;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> (<span class="dt">Eq</span> a, <span class="dt">Fractional</span> a) <span class="ot">=&gt;</span> <span class="dt">Fractional</span> (<span class="dt">S5</span> a) <span class="kw">where</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fromRational</span> a <span class="ot">=</span> <span class="dt">S</span> (<span class="fu">fromRational</span> a) <span class="dv">0</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">S</span> a b <span class="op">/</span> <span class="dt">S</span> c <span class="dv">0</span> <span class="ot">=</span> <span class="dt">S</span> (a<span class="op">/</span>c) (b<span class="op">/</span>c) <span class="co">-- This is okay as we only divide by 2 anyway</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">T</span> <span class="ot">=</span> <span class="dt">S5</span> <span class="dt">Rational</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="ot">fac ::</span> <span class="dt">Integer</span> <span class="ot">-&gt;</span> <span class="dt">Integer</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>fac n <span class="ot">=</span> <span class="fu">numerator</span> x</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- okay, also by s5 but we know it will be like this</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- and even the last minus does technically not need</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- to do the rational part.</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">S</span> <span class="dv">0</span> x <span class="ot">=</span> ((<span class="dv">1</span> <span class="op">+</span> s5)<span class="op">/</span><span class="dv">2</span>)<span class="op">^</span>n <span class="op">-</span> ((<span class="dv">1</span> <span class="op">-</span> s5)<span class="op">/</span><span class="dv">2</span>)<span class="op">^</span>n</span></code></pre></div>
<!-- the "fac" typo is genuine and intentionally left behind to
document that 2am tired brain effect -->
<p>Improvements might be possible but for now the matrix-inspired
version is still more efficient as <code>S</code> is holding to rational
number that are themselves tuples.</p>
</div>
<p>You feel a congratulatory tap on your back.
Well deserved. You feel satisfied. But tired too.
Actually really tired. You blink, look up at the
food-place employee giving you the ‚Äúwe are about to close look‚Äù.
There is nobody else in here, you are the last customer.</p>
<p>Confused, you stand up, stuff all your stuff into the backpack,
say quick thank you and bye and disappear into the night.</p>
<figure>
<img src="../images/fib-notebook.jpg" alt="Generic white-label wire-bound notebook" /><figcaption aria-hidden="true">Generic white-label wire-bound notebook</figcaption>
</figure>
</div><footer><p>Find me on <a href="https://github.com/xkollar/">GitHub</a>. Fancy an <a href="../atom.xml">Atom feed</a>?</p><p>H4sIAIisZlgAA3PLzy9JLdLT0wMAzFDh2gkAAAA=</p><p>Version 1, powered by <a href="https://jaspervdj.be/hakyll">Hakyll</a>.</p></footer></div></body>
</html>
